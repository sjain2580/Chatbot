FROM python:3.11-slim

# The working directory is now /backend inside the container.
WORKDIR /app

# ... (Install dependencies and Ollama) ...
# Copy requirements and install
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copy application code
# This copies everything from /backend (including main.py, app/, ai_service.py)
# into the Docker WORKDIR /app.
COPY . .

# Startup script
# This command needs to know where main.py is located.
CMD sh -c "ollama serve & python -m uvicorn main:app --host 0.0.0.0 --port ${PORT} --workers 1"